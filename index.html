<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>랜덤 비밀번호 생성기</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 설정 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        /* 1. CSS 변수를 사용하여 다크/라이트 모드 색상 정의 */
        :root {
            /* 라이트 테마 (기본값) */
            --color-bg: #f0f4f8;
            --color-card-bg: #ffffff;
            --color-text-main: #1f2937;
            --color-text-sub: #6b7280;
            --color-input-bg: #f3f4f6;
            --color-nav-bg: #e5e7eb;
            --color-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        [data-theme="dark"] {
            /* 다크 테마 오버라이드 */
            --color-bg: #0d1117;
            --color-card-bg: #1f2937;
            --color-text-main: #f3f4f6;
            --color-text-sub: #9ca3af;
            --color-input-bg: #111827;
            --color-nav-bg: #374151;
            --color-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
            background-color: var(--color-bg);
        }

        .card {
            background-color: var(--color-card-bg);
            box-shadow: var(--color-shadow);
        }
        .input-field {
            background-color: var(--color-input-bg);
            color: var(--color-text-main);
        }
        .text-main {
            color: var(--color-text-main);
        }
        .text-sub {
            color: var(--color-text-sub);
        }
        .nav-button {
            background-color: var(--color-nav-bg);
            color: var(--color-text-sub);
        }
        .nav-button.active {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
        }
        /* 비밀번호 강도 표시 CSS */
        #strength-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-md mx-auto p-6 rounded-2xl card transition-colors">
        
        <!-- 헤더 및 테마 토글 -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold text-main">비밀번호 생성기</h1>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                <!-- Moon icon for light mode (show dark mode option) / Sun icon for dark mode (show light mode option) -->
                <svg id="theme-icon" class="w-6 h-6 text-sub" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <!-- 기본은 Moon (다크 모드 옵션) -->
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </button>
        </header>

        <!-- 비밀번호 출력 필드 및 복사 버튼 -->
        <div class="mb-6">
            <div class="flex rounded-xl overflow-hidden shadow-inner">
                <input type="text" id="password-output" readonly placeholder="여기에 비밀번호가 표시됩니다"
                       class="input-field w-full p-4 text-lg border-none focus:outline-none transition-colors">
                <button id="copy-button"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m-2 4h-4m2 0h-4m2 0v4m-2-4v4"></path>
                    </svg>
                </button>
            </div>
            <!-- 비밀번호 강도 표시 바 -->
            <div class="mt-2 h-2 rounded-full bg-gray-300 dark:bg-gray-700 overflow-hidden">
                <div id="strength-bar" class="h-full rounded-full transition-all duration-300" style="width: 0%;"></div>
            </div>
            <p id="strength-text" class="text-sm mt-1 font-medium text-main"></p>
        </div>

        <!-- 탭 네비게이션 -->
        <nav class="flex justify-around mb-6 p-1 rounded-xl nav-button">
            <button class="nav-button active w-1/2 p-2 rounded-lg" data-target="options-complex">랜덤 문자/숫자</button>
            <button class="nav-button w-1/2 p-2 rounded-lg" data-target="options-pin">6자리 PIN</button>
        </nav>

        <!-- 복잡한 비밀번호 옵션 -->
        <div id="options-complex" class="options-content">
            <div class="space-y-4">
                
                <!-- 길이 슬라이더 -->
                <div>
                    <label for="length-slider" class="block text-sm font-medium text-main mb-2">
                        비밀번호 길이: <span id="length-value" class="font-semibold text-indigo-500">12</span>
                    </label>
                    <input type="range" id="length-slider" min="8" max="24" value="12"
                           class="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                </div>

                <!-- 문자 유형 옵션 -->
                <div class="space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" id="include-upper" checked
                               class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                        <label for="include-upper" class="ml-3 text-sm text-main">대문자 (A-Z)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="include-lower" checked
                               class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                        <label for="include-lower" class="ml-3 text-sm text-main">소문자 (a-z)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="include-numbers" checked
                               class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                        <label for="include-numbers" class="ml-3 text-sm text-main">숫자 (0-9)</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="include-symbols"
                               class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                        <label for="include-symbols" class="ml-3 text-sm text-main">특수 문자 (!@#$%)</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- PIN 옵션 -->
        <div id="options-pin" class="options-content hidden">
            <p class="text-sm text-sub">6자리 숫자로 구성된 PIN 번호를 생성합니다.</p>
        </div>

        <!-- 생성 버튼 -->
        <button id="generate-button"
                class="w-full mt-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl shadow-lg 
                       hover:bg-indigo-700 transition-colors duration-200 transform hover:scale-[1.01]">
            비밀번호 생성
        </button>
        
        <!-- 메시지 박스 -->
        <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full transition-all transform scale-100">
                <h3 id="message-title" class="text-xl font-bold text-main mb-3">알림</h3>
                <p id="message-content" class="text-sub mb-4">내용</p>
                <div class="flex justify-end space-x-3">
                    <button id="message-ok" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">확인</button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // 상수 정의
        const THEME_KEY = 'password-generator-theme';
        const UPPERCASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const LOWERCASE_CHARS = 'abcdefghijklmnopqrstuvwxyz';
        const NUMBERS = '0123456789';
        const SYMBOLS = '!@#$%^&*()_+~`|}{[]\\:;"\'<>,.?/';

        // DOM 요소 캐시
        const lengthSlider = document.getElementById('length-slider');
        const lengthValue = document.getElementById('length-value');
        const generateButton = document.getElementById('generate-button');
        const copyButton = document.getElementById('copy-button');
        const themeToggle = document.getElementById('theme-toggle');
        const optionsComplex = document.getElementById('options-complex');
        const optionsPin = document.getElementById('options-pin');
        const navButtons = document.querySelectorAll('.nav-button');
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        
        let currentMode = 'complex'; // 'complex' or 'pin'

        // ----------------- 유틸리티 및 UI -----------------

        /**
         * 커스텀 메시지 박스 표시 (alert() 대용)
         * @param {string} title
         * @param {string} message
         */
        function showMessageBox(title, message) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-content').textContent = message;
            const messageBox = document.getElementById('message-box');
            messageBox.classList.remove('hidden');
            messageBox.classList.add('flex');

            document.getElementById('message-ok').onclick = () => {
                messageBox.classList.add('hidden');
                messageBox.classList.remove('flex');
            };
        }

        /**
         * 텍스트를 클립보드에 복사
         * @param {string} text
         */
        function copyToClipboard(text) {
            // navigator.clipboard.writeText()는 iFrame 환경에서 작동하지 않을 수 있으므로, 구식 방법 사용
            const tempInput = document.createElement('textarea');
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            try {
                // document.execCommand('copy')는 이제 사용하지 않지만, 호환성을 위해 남겨둠
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessageBox('복사 완료', '비밀번호가 클립보드에 복사되었습니다.');
                } else {
                    // 대체 방법 (navigator.clipboard) 시도
                    navigator.clipboard.writeText(text).then(() => {
                        showMessageBox('복사 완료', '비밀번호가 클립보드에 복사되었습니다.');
                    }).catch(err => {
                        console.error('클립보드 복사 실패:', err);
                        showMessageBox('복사 실패', '클립보드 복사에 실패했습니다. 수동으로 복사해주세요.');
                    });
                }
            } catch (err) {
                console.error('복사 실패:', err);
                showMessageBox('복사 실패', '클립보드 복사에 실패했습니다. 수동으로 복사해주세요.');
            } finally {
                document.body.removeChild(tempInput);
            }
        }

        /**
         * 비밀번호 강도 측정 (Zxcvbn 알고리즘 근사치)
         * @param {string} password
         */
        function updateStrength(password) {
            let score = 0;
            const length = password.length;
            
            // 1. 길이 점수 (최대 4점)
            if (length >= 8) score += 1;
            if (length >= 12) score += 1;
            if (length >= 16) score += 1;
            if (length >= 20) score += 1;

            // 2. 문자 종류 점수 (최대 4점)
            let charTypes = 0;
            if (/[A-Z]/.test(password)) charTypes++;
            if (/[a-z]/.test(password)) charTypes++;
            if (/[0-9]/.test(password)) charTypes++;
            if (/[^A-Za-z0-9]/.test(password)) charTypes++;
            score += charTypes;
            
            // 총 점수는 8점을 넘지 않도록 조정
            score = Math.min(score, 8);
            
            let percent;
            let color;
            let text;

            if (score <= 3) {
                percent = 30;
                color = 'bg-red-500';
                text = '약함 (보통)';
            } else if (score <= 5) {
                percent = 50;
                color = 'bg-yellow-500';
                text = '보통 (좋음)';
            } else if (score <= 7) {
                percent = 75;
                color = 'bg-blue-500';
                text = '강함 (아주 좋음)';
            } else {
                percent = 100;
                color = 'bg-green-500';
                text = '매우 강력함 (최고)';
            }

            strengthBar.style.width = `${percent}%`;
            strengthBar.className = `h-full rounded-full transition-all duration-300 ${color}`;
            strengthText.textContent = `강도: ${text}`;
        }

        /**
         * 테마 적용 및 상태 저장
         * @param {string} theme
         */
        function applyTheme(theme) {
            const isDark = theme === 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem(THEME_KEY, theme);

            const icon = document.getElementById('theme-icon');
            // Moon icon (다크 모드 옵션) -> Light 모드일 때 보여줌
            // Sun icon (라이트 모드 옵션) -> Dark 모드일 때 보여줌
            icon.innerHTML = isDark
                ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>` // Sun
                : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`; // Moon
        }

        // ----------------- 이벤트 리스너 -----------------

        lengthSlider.addEventListener('input', () => {
            lengthValue.textContent = lengthSlider.value;
            // 길이가 바뀌면 복잡 비밀번호 모드에서 바로 재생성
            if (currentMode === 'complex') {
                generateComplexPassword();
            }
        });
        
        generateButton.addEventListener('click', () => {
            if (currentMode === 'complex') {
                generateComplexPassword();
            } else {
                generate6DigitPin();
            }
        });

        copyButton.addEventListener('click', () => {
            const password = document.getElementById('password-output').value;
            if (password) {
                copyToClipboard(password);
            } else {
                showMessageBox('알림', '먼저 비밀번호를 생성해주세요.');
            }
        });

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });
        
        // 탭 네비게이션 처리
        navButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const targetId = e.target.getAttribute('data-target');
                
                // 탭 상태 업데이트
                navButtons.forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                // 내용 전환
                optionsComplex.classList.add('hidden');
                optionsPin.classList.add('hidden');
                document.getElementById(targetId).classList.remove('hidden');

                // 모드 업데이트 및 새 비밀번호 생성
                currentMode = targetId === 'options-complex' ? 'complex' : 'pin';
                if (currentMode === 'complex') {
                    generateComplexPassword();
                } else {
                    generate6DigitPin();
                }
            });
        });

        // 체크박스가 변경될 때 복잡 비밀번호 재생성
        ['include-upper', 'include-lower', 'include-numbers', 'include-symbols'].forEach(id => {
            document.getElementById(id).addEventListener('change', () => {
                if (currentMode === 'complex') {
                    generateComplexPassword();
                }
            });
        });

        // ----------------- 비밀번호 생성 로직 -----------------

        /**
         * 복잡한 무작위 비밀번호 생성
         */
        function generateComplexPassword() {
            const length = parseInt(lengthSlider.value);
            let charSet = '';
            let password = '';
            let mustInclude = '';

            const includeUpper = document.getElementById('include-upper').checked;
            const includeLower = document.getElementById('include-lower').checked;
            const includeNumbers = document.getElementById('include-numbers').checked;
            const includeSymbols = document.getElementById('include-symbols').checked;
            
            // 1. 선택된 문자 집합 구성 및 최소 필수 문자 확보
            if (includeUpper) {
                charSet += UPPERCASE_CHARS;
                mustInclude += UPPERCASE_CHARS[Math.floor(Math.random() * UPPERCASE_CHARS.length)];
            }
            if (includeLower) {
                charSet += LOWERCASE_CHARS;
                mustInclude += LOWERCASE_CHARS[Math.floor(Math.random() * LOWERCASE_CHARS.length)];
            }
            if (includeNumbers) {
                charSet += NUMBERS;
                mustInclude += NUMBERS[Math.floor(Math.random() * NUMBERS.length)];
            }
            if (includeSymbols) {
                charSet += SYMBOLS;
                mustInclude += SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
            }

            if (charSet.length === 0) {
                document.getElementById('password-output').value = '옵션 선택 필수';
                updateStrength('');
                return;
            }

            // 2. 필수 문자를 먼저 포함하고, 나머지 길이를 무작위 문자로 채우기
            password += mustInclude;
            const remainingLength = length - mustInclude.length;
            for (let i = 0; i < remainingLength; i++) {
                const randomIndex = Math.floor(Math.random() * charSet.length);
                password += charSet[randomIndex];
            }

            // 3. 비밀번호를 섞어서 패턴을 없애고 최종 길이로 자르기
            password = password.split('').sort(() => 0.5 - Math.random()).join('').slice(0, length);
            
            // 결과 업데이트
            document.getElementById('password-output').value = password;
            updateStrength(password);
        }

        /**
         * 6자리 숫자 PIN 생성
         */
        function generate6DigitPin() {
            let pin = '';
            for (let i = 0; i < 6; i++) {
                pin += Math.floor(Math.random() * 10).toString();
            }
            document.getElementById('password-output').value = pin;
            updateStrength(pin);
        }

        // ----------------- 초기 실행 -----------------
        window.onload = function() {
            // 1. 테마 초기화 (Local Storage 또는 시스템 기본 설정에 따름)
            let savedTheme = localStorage.getItem(THEME_KEY);
            if (!savedTheme) {
                // 저장된 테마가 없으면 시스템 기본 설정을 따름
                // prefers-color-scheme: light 이면 'light' 아니면 'dark'
                savedTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
            }
            applyTheme(savedTheme);

            // 2. 탭 초기화 및 비밀번호 생성
            // 기본은 Complex 모드로 시작
            currentMode = 'complex';
            generateComplexPassword();
        }
    </script>
</body>
</html>